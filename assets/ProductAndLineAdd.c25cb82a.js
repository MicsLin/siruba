import{m as e,A as l,a,u as t,r as s,c as n,w as u,b as d,d as o,g as i,t as r,l as c,f as p,j as v,E as m,k as h,J as y,F as f,y as w,v as L,B as I,i as x,z as _,o as g,h as b}from"./vendor.ee801e80.js";import{d as O}from"./index.9e640917.js";import{d as A}from"./vuedraggable.umd.bb1aeaca.js";const P={class:"mt-12 flex sm:block py-4 sm:mb-4 text-4xl text-orange-siruba"},T={class:"w-full shadow"},B={class:"mb-4 flex items-center h-16 pl-8 sm:pl-4 pr-10 sm:pr-4 text-lg titleStyle sirubaBorder"},j={class:"flex items-center text-xl"},k=i("i",{class:"pe-7s-network pe-lg pe-va"},null,-1),S={class:"ml-3 mr-1"},C={class:"px-8 sm:px-2 py-6 sm:py-4 text-gray-500 text-sm sirubaBorder"},E={class:"mb-5 float-right sm:float-none flex flex-wrap"},R={class:"mr-2 sm:mb-2 btn btnBlueColor"},U={key:0,class:"sm:mb-2 btn btnBlueColor"},$=["onSubmit"],D={class:"mb-3 flex w-1/2 md:w-3/4 sm:w-full"},G={class:"w-16 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},M={class:"w-full"},N={value:"",disabled:"",hidden:""},V=["value"],q={class:"mb-3 flex w-1/2 md:w-3/4 sm:w-full"},H={class:"w-16 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},F={class:"w-full"},z={value:"",disabled:"",hidden:""},J=["value"],K={key:0,class:"flex items-center pl-6 py-4 w-full bg-yellow-100 text-yellow-700 rounded"},Q={key:1,class:"flex items-center pl-6 py-4 w-full bg-red-100 text-red-700 rounded"},W={class:"mb-3 flex w-1/2 md:w-3/4 sm:w-full"},X={class:"w-40 sm:w-48 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},Y={class:"w-full"},Z=["placeholder"],ee={class:"w-full"},le={class:"flex lg:block p-1 mb-5 rounded shadow"},ae={class:"flex mr-5 lg:mr-0 lg:mb-2 w-7/12 lg:w-full"},te={class:"flex mr-2 lg:mr-5 sm:mr-2"},se={class:"w-16 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},ne=["value"],ue={class:"flex w-full"},de={class:"w-16 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},oe={class:"w-full"},ie=["onUpdate:modelValue","onChange"],re={value:void 0,disabled:"",hidden:""},ce=["value"],pe={key:0},ve={class:"flex justify-between lg:justify-start w-5/12 lg:w-full"},me={class:"flex"},he={class:"w-16 sm:w-8 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},ye={key:0,type:"text",class:"w-10 md:w-8 sm:w-8 rounded-l-none myInputReadonly",readonly:""},fe=["onUpdate:modelValue"],we={class:"flex lg:mx-2 sm:mx-1"},Le=i("div",{class:"w-8 sm:w-6 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},[i("div",null," + ")],-1),Ie={key:0,type:"text",class:"w-10 md:w-8 sm:w-8 rounded-l-none myInputReadonly",readonly:""},xe=["onUpdate:modelValue"],_e={class:"flex lg:mr-2 sm:mr-1"},ge=i("div",{class:"w-8 sm:w-6 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},[i("div",null,"-")],-1),be={key:0,type:"text",class:"w-10 md:w-8 sm:w-8 rounded-l-none myInputReadonly",readonly:""},Oe=["onUpdate:modelValue"],Ae={class:"flex"},Pe={class:"w-16 sm:w-8 h-9 flex items-center justify-center myInputSearchTitle rounded-l"},Te={key:0,type:"text",class:"w-10 md:w-8 sm:w-8 rounded-l-none myInputReadonly",readonly:""},Be=["onUpdate:modelValue"],je={type:"submit",class:"btn btnBlueColor"},ke={setup(ke){const Se=e(),Ce=l(),Ee=a(),Re=t(),Ue=s(Se.locale.value),$e=n((()=>Re.state.resData.adminName)),De=n((()=>Re.state.resData.token)),Ge=n((()=>Re.state.serverURL)),Me=s(Re.state.resData.adminPagesPermit),Ne=s(Me.value.split(",")),Ve=s(Ce.query.lineId),qe=s(""),He=s([]),Fe=s([]),ze=s(0),Je=s(0),Ke=s([]),Qe=s([]),We=s([]),Xe=s([]),Ye=s([]),Ze=s([]),el=s([]),ll=s(!1),al=function(){if(ll.value=!1,Ve.value){let e={},l={},a={},t=new FormData;t.append("token",De.value),t.append("lineId",Ve.value),t.append("productId",qe.value),_.post(`http://${Ge.value}/product_machine.php`,t).then((t=>{if(O(t.data),1==t.data.status){let s=t.data.data;e=s.lineList,l=s.productList,a=s.processList,Ke.value=Object.keys(s.lineList),We.value=Object.keys(s.productList),Ye.value=s.machineList,Fe.value.length=Ye.value.length,Object.keys(a).length>0&&(Ze.value=Object.keys(a)),Je.value=0,s.processMajorId&&(Je.value=s.processMajorId)}else 2==t.data.status||3==t.data.status||(ll.value=!0)})).then((()=>{if(0==Qe.value.length)for(let l=0;l<Ke.value.length;l++)Qe.value.push(e[Ke.value[l]]);if(0==Xe.value.length)for(let e=0;e<We.value.length;e++)Xe.value.push(l[We.value[e]]);if(Ze.value.length>0)for(let e=0;e<Ze.value.length;e++)el.value.push(a[Ze.value[e]])})).catch((e=>{Ee.push("/production_line_set")}))}else Ee.push("/production_line_set")};al();const tl=function(){if(He.value.length>0)if(ze.value>0){let e=function(){let e="";"tw"==Ue.value&&(e="此產品尚未設定主要製程\r\n請到產品設定頁面設定主要製程"),"en"==Ue.value&&(e="This product has not set the major process\r\nPlease go to the product setting page to set the major process"),"jp"==Ue.value&&(e="この製品はメインプロセスを設定していません\r\n製品設定ページに移動して、メインプロセスを設定してください"),"cn"==Ue.value&&(e="此产品尚未设定主要制程\r\n请到产品设定页面设定主要制程"),alert(e)},l=function(){let e="";"tw"==Ue.value&&(e="主要製程尚未與機台配對"),"en"==Ue.value&&(e="The Major process has not been paired with the machine"),"jp"==Ue.value&&(e="メインプロセスはマシンとペアリングされていません"),"cn"==Ue.value&&(e="主要制程尚未与机台配对"),alert(e)},a=new FormData;a.append("token",De.value),a.append("adminName",$e.value),a.append("lineId",Ve.value),a.append("productId",qe.value),a.append("target",ze.value),Ye.value.forEach((e=>{let l=He.value[e.machineId];l&&a.append(`process[${e.machineId}]`,l)})),_.post(`http://${Ge.value}/insertsql/prodmac.php`,a).then((a=>{O(a.data),1==a.data.status?Ee.push({name:"ProductionLineSet",params:{lineId:Ve.value}}):2==a.data.status?Ee.push("/login"):3==a.data.status?Ee.push("/production_line_set"):4==a.data.status?e():5==a.data.status?l():Ee.push("/production_line_set")})).catch((e=>{location.reload()}))}else"tw"==Ue.value&&alert("班次目標必須大於0"),"cn"==Ue.value&&alert("班次目标必须大于0"),"jp"==Ue.value&&alert("シフト目標は0より大きくなければなりません"),"en"==Ue.value&&alert("Target must be greater than 0");else"tw"==Ue.value&&alert("請至少設定一台機台的製程"),"cn"==Ue.value&&alert("请至少设定一台机台的制程"),"jp"==Ue.value&&alert("少なくとも1台のマシンのプロセスを設定してください"),"en"==Ue.value&&alert("Please set the process of at least one machine")};return u((()=>Ve.value),(e=>{qe.value?qe.value="":(ze.value=0,al())})),u((()=>qe.value),(e=>{Ze.value=[],el.value=[],He.value=[],Fe.value=[],ze.value=0,al()})),u((()=>Se.locale.value),(e=>{Ue.value=e})),(e,l)=>{const a=d("router-link");return g(),o(f,null,[i("h1",P,r(e.$t("GLOBAL.GLOBAL_LINE"))+"-"+r(e.$t("GLOBAL.GLOBAL_PRODUCT")),1),i("div",T,[i("div",B,[i("span",j,[k,i("span",S,r(e.$t("GLOBAL.GLOBAL_ADD"))+" "+r(e.$t("GLOBAL.GLOBAL_LINE"))+"-"+r(e.$t("GLOBAL.GLOBAL_PRODUCT")),1)])]),i("div",C,[i("div",E,[i("div",R,[c(a,{to:"/production_line_set"},{default:p((()=>[b(r(e.$t("ProductMachine.PM_BACK")),1)])),_:1})]),(t=6,0!=Ne.length&&Ne.value.find((e=>e==t))?(g(),o("div",U,[c(a,{to:"/product_set"},{default:p((()=>[b(r(e.$t("PRODUCT_LINE.PL_ADD_PRODUCT")),1)])),_:1})])):v("",!0))]),i("form",{onSubmit:m(tl,["prevent"])},[i("div",D,[i("div",G,[i("div",null,r(e.$t("PRODUCT_LINE.PL_LINE")),1)]),i("div",M,[h(i("select",{class:"w-full myInput rounded-r rounded-l-none","onUpdate:modelValue":l[0]||(l[0]=e=>Ve.value=e),required:""},[i("option",N,r(e.$t("ProductMachine.PM_SELECT")),1),(g(!0),o(f,null,w(Qe.value,((e,l)=>(g(),o("option",{key:"lineList"+l,value:Ke.value[l]},r(e),9,V)))),128))],512),[[y,Ve.value]])])]),i("div",q,[i("div",H,[i("div",null,r(e.$t("GLOBAL.GLOBAL_PRODUCT")),1)]),i("div",F,[h(i("select",{class:"w-full myInput rounded-r rounded-l-none","onUpdate:modelValue":l[1]||(l[1]=e=>qe.value=e),required:""},[i("option",z,r(e.$t("ProductMachine.PM_SELECT")),1),(g(!0),o(f,null,w(Xe.value,((e,l)=>(g(),o("option",{key:"productList"+l,value:We.value[l]},r(e),9,J)))),128))],512),[[y,qe.value]])])]),ll.value?(g(),o("div",K,r(e.$t("PRODUCT_LINE.PL_DOUBLE_MATCH")),1)):v("",!0),0==Ye.value.length?(g(),o("div",Q,r(e.$t("PRODUCT_LINE.PL_NO_MACHINES")),1)):v("",!0),h(i("div",null,[i("div",W,[i("div",X,[i("div",null,r(e.$t("PRODUCT_LINE.PL_TARGET")),1)]),i("div",Y,[h(i("input",{type:"number",min:"0",step:"1",class:"myInput w-full rounded-l-none",placeholder:e.$t("PRODUCT_LINE.PL_STANDARD_PLACEHOLDER"),"onUpdate:modelValue":l[2]||(l[2]=e=>ze.value=e),required:""},null,8,Z),[[I,ze.value]])])]),i("div",ee,[c(x(A),{list:Ye.value,"item-key":"name"},{item:p((({element:l})=>[i("div",le,[i("div",ae,[i("div",te,[i("div",se,[i("div",null,r(e.$t("GLOBAL.GLOBAL_MACHINE")),1)]),i("div",null,[i("input",{type:"text",value:l.machineName,class:"w-42 lg:w-full sm:px-0 rounded-l-none myInputReadonly cursor-move",readonly:""},null,8,ne)])]),i("div",ue,[i("div",de,[i("div",null,r(e.$t("GLOBAL.GLOBAL_PROCESS")),1)]),i("div",oe,[h(i("select",{class:"w-full myInput rounded-l-none pe-7s-star pe-va","onUpdate:modelValue":e=>He.value[l.machineId]=e,onChange:e=>function(e){let l={},a=He.value[e],t=new FormData;t.append("token",De.value),t.append("processId",a),_.post(`http://${Ge.value}/autofill-ajax.php`,t).then((e=>{O(e.data),1==e.data.status?l=e.data.data:2==e.data.status?Ee.push("/login"):location.reload()})).then((()=>{Fe.value[e]=l})).catch((e=>{location.reload()}))}(l.machineId)},[i("option",re,r(e.$t("ProductMachine.PM_SELECT")),1),(g(!0),o(f,null,w(el.value,((e,l)=>(g(),o("option",{key:"processList"+l,value:Ze.value[l],class:"pe-7s-star pe-va"},[Je.value==Ze.value[l]?(g(),o("span",pe,"")):v("",!0),b(" "+r(e),1)],8,ce)))),128))],40,ie),[[y,He.value[l.machineId]]])])])]),i("div",ve,[i("div",me,[i("div",he,[i("div",null,r(e.$t("GLOBAL.GLOBAL_STITCH")),1)]),i("div",null,[null==Fe.value[l.machineId]?(g(),o("input",ye)):h((g(),o("input",{key:1,type:"text",class:"w-10 md:w-8 sm:w-8 rounded-l-none myInputReadonly","onUpdate:modelValue":e=>Fe.value[l.machineId].processStitch=e,readonly:""},null,8,fe)),[[I,Fe.value[l.machineId].processStitch]])])]),i("div",we,[Le,i("div",null,[null==Fe.value[l.machineId]?(g(),o("input",Ie)):h((g(),o("input",{key:1,type:"text",class:"w-10 md:w-8 sm:w-8 rounded-l-none myInputReadonly","onUpdate:modelValue":e=>Fe.value[l.machineId].processStitchP=e,readonly:""},null,8,xe)),[[I,Fe.value[l.machineId].processStitchP]])])]),i("div",_e,[ge,i("div",null,[null==Fe.value[l.machineId]?(g(),o("input",be)):h((g(),o("input",{key:1,type:"text",class:"w-10 md:w-8 sm:w-8 rounded-l-none myInputReadonly","onUpdate:modelValue":e=>Fe.value[l.machineId].processStitchM=e,readonly:""},null,8,Oe)),[[I,Fe.value[l.machineId].processStitchM]])])]),i("div",Ae,[i("div",Pe,[i("div",null,r(e.$t("GLOBAL.GLOBAL_TRIM")),1)]),i("div",null,[null==Fe.value[l.machineId]?(g(),o("input",Te)):h((g(),o("input",{key:1,type:"text",class:"w-10 md:w-8 sm:w-8 rounded-l-none myInputReadonly","onUpdate:modelValue":e=>Fe.value[l.machineId].processCut=e,readonly:""},null,8,Be)),[[I,Fe.value[l.machineId].processCut]])])])])])])),_:1},8,["list"])]),i("button",je,r(e.$t("GLOBAL.GLOBAL_SAVE")),1)],512),[[L,qe.value&&!ll.value&&Ye.value.length>0]])],40,$)])])],64);var t}}};export{ke as default};
